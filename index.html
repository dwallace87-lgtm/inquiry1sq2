<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEQ 2 Cause & Effect Timeline</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .timeline-dot {
      content: ''; position: absolute; top: 2.5rem; width: 20px; height: 20px; border-radius: 50%;
      background-color: #22d3ee; border: 4px solid #1e293b; z-index: 10;
    }
    .source-title { transition: all .3s ease; }
    .source-title:hover { color: #67e8f9; }
    .context-button {
      display: inline-flex; align-items: center; justify-content: center;
      gap: 0.5rem; padding: 0.5rem 1.5rem; font-size: 0.875rem; font-weight: 600;
      border-radius: 9999px; border: 1px solid rgba(56, 189, 248, 0.55);
      background: linear-gradient(135deg, rgba(6, 182, 212, 0.22), rgba(59, 130, 246, 0.18));
      color: #e0f2fe; transition: all .3s ease; white-space: nowrap;
      box-shadow: 0 12px 32px rgba(6, 182, 212, 0.25), inset 0 0 0 1px rgba(15, 118, 110, 0.25);
    }
    .context-button:hover {
      transform: translateY(-1px);
      background: linear-gradient(135deg, rgba(6, 182, 212, 0.32), rgba(59, 130, 246, 0.28));
      color: #f8fafc; border-color: rgba(165, 243, 252, 0.7);
      box-shadow: 0 18px 40px rgba(6, 182, 212, 0.35), inset 0 0 0 1px rgba(125, 211, 252, 0.4);
    }
    .context-button:focus-visible {
      outline: none;
      transform: translateY(-1px);
      box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.35), 0 20px 45px rgba(14, 165, 233, 0.4);
    }
    .vocab-word {
      color:#fde047; font-weight:600; cursor:pointer; text-decoration-line:underline;
      text-decoration-style:dotted; text-decoration-color: rgba(253,224,71,.5); transition:all .3s ease;
    }
    .vocab-word:hover { color:#fef08a; text-decoration-color:#fef08a; }
    .full-bleed {
      width: 100vw; position: relative; left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw;
    }
    textarea.auto { overflow: hidden; resize: none; min-height: 3rem; }
    .timeline-title {
      display: block;
      width: 100%;
      max-width: 72rem;
      height: auto;
      object-fit: contain;
      filter:
        drop-shadow(0 0 18px rgba(59, 130, 246, 0.45))
        drop-shadow(0 0 32px rgba(165, 243, 252, 0.35));
    }
    /* Attention ring for Student Info bar */
    .pulse-ring {
      box-shadow: 0 0 0 0 rgba(34, 211, 238, 0.6);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(34, 211, 238, 0.6); }
      70% { box-shadow: 0 0 0 16px rgba(34, 211, 238, 0); }
      100% { box-shadow: 0 0 0 0 rgba(34, 211, 238, 0); }
    }
  </style>
</head>
<body class="bg-slate-900 text-slate-200 h-full overflow-y-auto">

  <!-- VERY NOTICEABLE STUDENT INFO BAR -->
  <div class="full-bleed bg-gradient-to-r from-cyan-500/20 via-fuchsia-500/20 to-amber-500/20 border-b border-slate-700">
    <div class="max-w-7xl mx-auto px-4 py-6">
      <div class="bg-slate-800/70 border border-slate-700 rounded-2xl p-4 md:p-6 pulse-ring">
        <div class="flex items-center gap-3 mb-4">
          <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-cyan-500 text-slate-900 font-extrabold text-xl">i</span>
          <h2 class="text-2xl md:text-3xl font-extrabold tracking-tight">
            Enter your name and class period before you start
          </h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4">
          <!-- First Name -->
          <div>
            <label for="first-name" class="block text-sm font-semibold text-slate-300">First Name</label>
            <input
              id="first-name" name="first_name" type="text" inputmode="text" autocomplete="given-name" required
              data-persist
              placeholder="e.g., Alex"
              class="mt-1 w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-cyan-500 focus:outline-none">
          </div>
          <!-- Last Name -->
          <div>
            <label for="last-name" class="block text-sm font-semibold text-slate-300">Last Name</label>
            <input
              id="last-name" name="last_name" type="text" inputmode="text" autocomplete="family-name" required
              data-persist
              placeholder="e.g., Johnson"
              class="mt-1 w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-cyan-500 focus:outline-none">
          </div>
          <!-- Class Period -->
          <div>
            <label for="class-period" class="block text-sm font-semibold text-slate-300">Class Period</label>
            <select
              id="class-period" name="class_period" required data-persist
              class="mt-1 w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none">
              <option value="" disabled selected>Select a period</option>
              <option value="3">3</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
            </select>
          </div>
        </div>
        <p class="mt-3 text-sm text-slate-400">
          Pro tip: Use the “Save Progress” button at the bottom, or just type and I’ll auto-save for you.
        </p>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8 md:py-12 max-w-7xl">
    <!-- Header -->
    <header class="text-center mb-12 md:mb-16">
      <h2 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-teal-400 via-red-500 to-amber-400 bg-clip-text text-transparent mb-4">
        SQ2: How did the "Doctrine of Discovery" lead to Manifest Destiny in the United States?
      </h2>
      <img
        src="https://lh3.googleusercontent.com/d/1Biy7nJ1hP5r0J47ukR7CNgzui08jJA3w"
        alt="Cause and Effect Timeline"
        class="timeline-title mx-auto mb-6"
        loading="lazy"
      >
      <p class="text-lg md:text-xl text-slate-400 max-w-3xl mx-auto">
        A timeline of land acquisition in the United States up to 1956. For each source, identify the
        <span class="text-pink-400 font-medium">Cause</span> and the
        <span class="text-cyan-400 font-medium">Effect</span>.
      </p>
    </header>

    <!-- Featured Source A -->
    <div id="source-a-doc" class="mb-12 md:mb-16">
      <div class="bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 rounded-2xl shadow-2xl border border-slate-700 max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
          <h2 class="text-2xl font-bold text-white">SQ2: Featured Source A - Excerpt from "Inter Caetera"</h2>
          <button type="button" class="context-button" data-source="A" aria-expanded="false">
            Historical Context
          </button>
        </div>
        <div class="text-slate-300 space-y-4 leading-relaxed">
          <p>We have indeed learned that you... discovered certain very remote islands and even mainlands that
            <span class="vocab-word" data-vocab="hitherto">hitherto</span> had not been discovered by others; wherein dwell very many peoples living in peace... [...] these very peoples ... seem sufficiently
            <span class="vocab-word" data-vocab="disposed">disposed</span> to embrace the Catholic faith and be trained in good morals.</p>
          <p>And, in order that you may enter upon so great an undertaking... endowed with the benefit of our
            <span class="vocab-word" data-vocab="apostolic favor">apostolic favor</span>, we ... give, grant, and assign to you and your heirs and successors ... all their [Native peoples¹]
            <span class="vocab-word" data-vocab="dominions">dominions</span>, cities, camps, places, and villages, and all rights,
            <span class="vocab-word" data-vocab="jurisdictions">jurisdictions</span>, and
            <span class="vocab-word" data-vocab="appurtenances">appurtenances</span>², all islands and mainlands found and to be found, discovered and to be discovered.</p>
          <hr class="border-slate-700">
          <p class="text-sm text-slate-400"><strong>Source:</strong> The Inter Caetera is a Papal Bull sent from Pope Alexander VI on May 4, 1493</p>
          <div class="mt-6 flex justify-end">
            <a href="#entry-source-a" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
              <span>Go to Source A Entry</span>
              <span aria-hidden="true">⤵</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Featured Source B (with Jackson portrait) -->
    <div id="source-b-doc" class="mb-12 md:mb-16">
      <div class="bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 rounded-2xl shadow-2xl border border-slate-700 max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
          <h2 class="text-2xl font-bold text-white">SQ2: Featured Source B - Excerpt from President Andrew Jackson's Message to Congress (1830)</h2>
          <button type="button" class="context-button" data-source="B" aria-expanded="false">
            Historical Context
          </button>
        </div>
        <div class="text-slate-300 leading-relaxed">
          <!-- Subtle portrait, original shape, not too small -->
          <img
            src="https://e7.pngegg.com/pngimages/972/220/png-clipart-andrew-jackson-1924-democratic-national-convention-united-states-1832-democratic-national-convention-united-states-head-political-party-thumbnail.png"
            alt="President Andrew Jackson"
            class="w-28 md:w-40 h-auto md:float-right md:ml-4 mb-3 opacity-90 hover:opacity-100 transition"
            loading="lazy" decoding="async" referrerpolicy="no-referrer"
          />

          <div class="space-y-4">
            <p>
              It gives me pleasure to announce to Congress that the
              <span class="vocab-word" data-vocab="benevolent">benevolent</span>
              policy of the Government...in relation to the removal of the Indians beyond the white settlements is approaching a happy
              <span class="vocab-word" data-vocab="consummation">consummation</span>. ...it is believed that their example will
              <span class="vocab-word" data-vocab="induce">induce</span> the remaining tribes also to seek the same obvious advantages.
            </p>
            <p>
              The consequences of a speedy removal will be important to the United States, to individual States, and to the Indians themselves. The
              <span class="vocab-word" data-vocab="pecuniary">pecuniary</span>
              advantages which it promises to the Government are the least of its recommendations. It puts an end to all possible danger of collision... It will place a dense and civilized population in large
              <span class="vocab-word" data-vocab="tracts">tracts</span>
              of country now occupied by a few savage hunters.
            </p>
            <p>
              The tribes which occupied the countries now constituting the Eastern States were
              <span class="vocab-word" data-vocab="annihilated">annihilated</span>
              or have melted away to make room for the whites. ...we now propose to acquire the countries occupied by the red men of the South and West by a fair exchange, and, at the expense of the United States, to send them to land where their existence may be prolonged and perhaps made
              <span class="vocab-word" data-vocab="perpetual">perpetual</span>.
            </p>
            <hr class="border-slate-700">
            <p class="text-sm text-slate-400"><strong>Source:</strong> Our Documents, 1830</p>
          </div>
          <div class="mt-6 flex justify-end">
            <a href="#entry-source-b" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
              <span>Go to Source B Entry</span>
              <span aria-hidden="true">⤵</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Featured Source C -->
    <div id="source-c-doc" class="mb-12 md:mb-16">
      <div class="bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 rounded-2xl shadow-2xl border border-slate-700 max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
          <h2 class="text-2xl font-bold text-white">SQ2: Featured Source C - Excerpt from John O'Sullivan, "Annexation" (1845)</h2>
          <button type="button" class="context-button" data-source="C" aria-expanded="false">
            Historical Context
          </button>
        </div>
        <div class="text-slate-300 space-y-4 leading-relaxed">
          <p>Texas is now ours. Already... her star and her stripe may already be said to have taken their place in the glorious <span class="vocab-word" data-vocab="blazon">blazon</span> of our common nationality; and the sweep of our eagle's wing already includes within its circuit the wide extent of her fair and <span class="vocab-word" data-vocab="fertile">fertile</span> land.</p>
          <p>She is no longer to us a mere <span class="vocab-word" data-vocab="geographical">geographical</span> space... She is no longer to us a mere country on the map. She comes within the dear and sacred <span class="vocab-word" data-vocab="designation">designation</span> of Our Country....</p>
          <p>California will, probably, next fall away from the loose <span class="vocab-word" data-vocab="adhesion">adhesion</span> which, in such a country as Mexico, holds a remote province in a slight <span class="vocab-word" data-vocab="equivocal">equivocal</span> kind of dependence on the metropolis. <span class="vocab-word" data-vocab="Imbecile">Imbecile</span> and distracted, Mexico never can <span class="vocab-word" data-vocab="exert">exert</span> any real governmental authority over such a country....</p>
          <p>A population will soon be in actual occupation of California, over which it will be idle for Mexico to dream of <span class="vocab-word" data-vocab="dominion">dominion</span>. ...this without <span class="vocab-word" data-vocab="agency">agency</span> of our government...in the natural flow of events, the <span class="vocab-word" data-vocab="spontaneous">spontaneous</span> working of principles...they will have a right to independence...a better and truer right than the artificial <span class="vocab-word" data-vocab="sovereignty">sovereignty</span> in Mexico... their right to independence will be the natural right of self-government... there can be no doubt that the population now fast <span class="vocab-word" data-vocab="streaming">streaming</span> down upon California will both assert and maintain that independence. Whether they will then attach themselves to our Union or not is not to be predicted with any certainty.</p>
          <hr class="border-slate-700">
          <p class="text-sm text-slate-400"><strong>Source:</strong> Bill of Rights Institute</p>
        </div>
        <div class="mt-6 flex justify-end">
          <a href="#entry-source-c" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
            <span>Go to Source C Entry</span>
            <span aria-hidden="true">⤵</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Featured Source D (Map with clickable full image) -->
    <div id="source-d-doc" class="mb-12 md:mb-16">
      <div class="bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 rounded-2xl shadow-2xl border border-slate-700 max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
          <h2 class="text-2xl font-bold text-white">SQ2: Featured Source D – United States Map (1842–1845)</h2>
          <button type="button" class="context-button" data-source="D" aria-expanded="false">
            Historical Context
          </button>
        </div>
        <div class="text-slate-300 leading-relaxed space-y-4">
          <p class="text-slate-400 text-sm">Click the map to open the full-size image in a new tab.</p>
          <a
            href="https://upload.wikimedia.org/wikipedia/commons/b/b9/United_States_1842-1845-03.png?20071118003821"
            target="_blank" rel="noopener noreferrer" class="group block">
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/b/b9/United_States_1842-1845-03.png?20071118003821"
              alt="United States territorial map, 1842–1845"
              class="w-full h-auto rounded-xl border border-slate-700/70 shadow-lg group-hover:shadow-cyan-500/10 transition"
              loading="lazy" decoding="async"
            />
          </a>
          <hr class="border-slate-700">
          <p class="text-sm text-slate-400"><strong>Source:</strong> Wikimedia Commons</p>
        </div>
        <div class="mt-6 flex justify-end">
          <a href="#entry-source-d" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
            <span>Go to Source D Entry</span>
            <span aria-hidden="true">⤵</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Featured Source E -->
    <div id="source-e-doc" class="mb-12 md:mb-16">
      <div class="bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 rounded-2xl shadow-2xl border border-slate-700 max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
          <h2 class="text-2xl font-bold text-white">SQ2: Featured Source E - Robert J. Miller, <em>Native America, Discovered and Conquered</em> (2008)</h2>
          <button type="button" class="context-button" data-source="E" aria-expanded="false">
            Historical Context
          </button>
        </div>
        <div class="text-slate-300 space-y-4 leading-relaxed">
          <p>
            Legal scholar Robert J. Miller traces how the Doctrine of Discovery migrated from fifteenth-century papal bulls into United States policy.
            He explains that leaders such as Thomas Jefferson applied the doctrine to justify exploration, surveying, and the claiming of Indigenous homelands across the continent.
          </p>
          <p>
            Miller argues that the same principles continued to influence American expansion during the nineteenth century and beyond.
            By embedding the doctrine in federal law and Supreme Court rulings, the United States asserted a superior title over Native nations and laid the groundwork for Manifest Destiny.
          </p>
          <hr class="border-slate-700">
          <p class="text-sm text-slate-400"><strong>Source:</strong> Robert J. Miller, <em>Native America, Discovered and Conquered</em>, 2008</p>
        </div>
        <div class="mt-6 flex justify-end">
          <a href="#entry-source-e" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
            <span>Go to Source E Entry</span>
            <span aria-hidden="true">⤵</span>
          </a>
        </div>
      </div>
    </div>

    <!-- FORM full-bleed sections -->
    <form id="timeline-form" class="space-y-10">
      <!-- Source A -->
      <section id="entry-source-a" class="relative">
        <div class="full-bleed bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 border-t border-b border-slate-700">
          <div class="mb-3">
            <h2 class="text-xl font-bold text-white source-title">
              Source A: Pope Alexander VI, "Inter Caetera Bull of May 4, 1493 (Doctrine of Discovery)"
            </h2>
          </div>
          <label for="date-a" class="block text-sm font-medium text-slate-400">Event</label>
          <textarea id="date-a" name="date-a" rows="1" data-persist
            placeholder="e.g., Papal bull grants land to Spain"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mt-1 mb-4"></textarea>

          <label for="cause-a" class="block text-sm font-medium text-pink-400">Cause</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">What motivated this doctrine? Think about exploration and religion.</p>
          <textarea id="cause-a" name="cause-a" rows="3" data-persist
            placeholder="What led to this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mb-4"></textarea>

          <label for="effect-a" class="block text-sm font-medium text-cyan-400">Effect</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">What power did this give European nations? How did it view native land?</p>
          <textarea id="effect-a" name="effect-a" rows="3" data-persist
            placeholder="What happened because of this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-all duration-300"></textarea>
          <div class="mt-6 flex justify-end">
            <a href="#source-a-doc" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
              <span aria-hidden="true">⤴</span>
              <span>Back to Source A Reading</span>
            </a>
          </div>
        </div>
      </section>

      <!-- Source B -->
      <section id="entry-source-b" class="relative">
        <div class="full-bleed bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 border-t border-b border-slate-700">
          <div class="mb-3">
            <h2 class="text-xl font-bold text-white source-title">
              Source B: President Andrew Jackson's Message to Congress on Indian Removal, 6 Dec 1830
            </h2>
          </div>
          <label for="date-b" class="block text-sm font-medium text-slate-400">Event</label>
          <textarea id="date-b" name="date-b" rows="1" data-persist
            placeholder="e.g., Jackson's policy proposal"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mt-1 mb-4"></textarea>

          <label for="cause-b" class="block text-sm font-medium text-pink-400">Cause</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">What ideas from Source A might justify this? What was the immediate pressure (e.g., land for settlers)?</p>
          <textarea id="cause-b" name="cause-b" rows="3" data-persist
            placeholder="What led to this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mb-4"></textarea>

          <label for="effect-b" class="block text-sm font-medium text-cyan-400">Effect</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">What was the immediate result for tribes? What was the long-term impact on U.S. expansion?</p>
          <textarea id="effect-b" name="effect-b" rows="3" data-persist
            placeholder="What happened because of this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-all duration-300"></textarea>
          <div class="mt-6 flex justify-end">
            <a href="#source-b-doc" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
              <span aria-hidden="true">⤴</span>
              <span>Back to Source B Reading</span>
            </a>
          </div>
        </div>
      </section>

      <!-- Source C -->
      <section id="entry-source-c" class="relative">
        <div class="full-bleed bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 border-t border-b border-slate-700">
          <div class="mb-3">
            <h2 class="text-xl font-bold text-white source-title">
              Source C: John O'Sullivan, "Annexation," 1845
            </h2>
          </div>
          <label for="date-c" class="block text-sm font-medium text-slate-400">Event</label>
          <textarea id="date-c" name="date-c" rows="1" data-persist
            placeholder="e.g., O'Sullivan's argument for annexation"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mt-1 mb-4"></textarea>

          <label for="cause-c" class="block text-sm font-medium text-pink-400">Cause</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">How does this idea connect to the 'discovery' concept (Source A) and removal (Source B)?</p>
          <textarea id="cause-c" name="cause-c" rows="3" data-persist
            placeholder="What led to this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mb-4"></textarea>

          <label for="effect-c" class="block text-sm font-medium text-cyan-400">Effect</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">How did this idea (Manifest Destiny) shape U.S. policy and public opinion?</p>
          <textarea id="effect-c" name="effect-c" rows="3" data-persist
            placeholder="What happened because of this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-all duration-300"></textarea>
          <div class="mt-6 flex justify-end">
            <a href="#source-c-doc" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
              <span aria-hidden="true">⤴</span>
              <span>Back to Source C Reading</span>
            </a>
          </div>
        </div>
      </section>

      <!-- Source D -->
      <section id="entry-source-d" class="relative">
        <div class="full-bleed bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 border-t border-b border-slate-700">
          <div class="mb-3">
            <h2 class="text-xl font-bold text-white source-title">
              Source D: United States, 1842-1856 Map
            </h2>
          </div>
          <label for="date-d" class="block text-sm font-medium text-slate-400">Event</label>
          <textarea id="date-d" name="date-d" rows="1" data-persist
            placeholder="e.g., U.S. territorial expansion shown on map"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mt-1 mb-4"></textarea>

          <label for="cause-d" class="block text-sm font-medium text-pink-400">Cause</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">What specific events (wars, treaties, purchases) led to the new borders shown?</p>
          <textarea id="cause-d" name="cause-d" rows="3" data-persist
            placeholder="What led to this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mb-4"></textarea>

          <label for="effect-d" class="block text-sm font-medium text-cyan-400">Effect</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">What does this map show as the physical result of the ideas in Sources A, B, and C?</p>
          <textarea id="effect-d" name="effect-d" rows="3" data-persist
            placeholder="What happened because of this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-all duration-300"></textarea>
          <div class="mt-6 flex justify-end">
            <a href="#source-d-doc" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
              <span aria-hidden="true">⤴</span>
              <span>Back to Source D Reading</span>
            </a>
          </div>
        </div>
      </section>

      <!-- Source E -->
      <section id="entry-source-e" class="relative">
        <div class="full-bleed bg-slate-800 bg-opacity-70 backdrop-blur-md p-6 md:p-8 border-t border-b border-slate-700">
          <div class="mb-3">
            <h2 class="text-xl font-bold text-white source-title">
              Source E: Robert J. Miller, "Native America, Discovered and Conquered: Thomas Jefferson, Lewis and Clark, and Manifest Destiny"
            </h2>
          </div>
          <label for="date-e" class="block text-sm font-medium text-slate-400">Event</label>
          <textarea id="date-e" name="date-e" rows="1" data-persist
            placeholder="e.g., Miller's analysis of Manifest Destiny"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mt-1 mb-4"></textarea>

          <label for="cause-e" class="block text-sm font-medium text-pink-400">Cause</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">According to Miller, what is the intellectual or legal foundation for Manifest Destiny?</p>
          <textarea id="cause-e" name="cause-e" rows="3" data-persist
            placeholder="What led to this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-pink-500 focus:outline-none transition-all duration-300 mb-4"></textarea>

          <label for="effect-e" class="block text-sm font-medium text-cyan-400">Effect</label>
          <p class="text-xs text-slate-400 italic mt-1 mb-2">How does Miller's analysis connect all the sources (A, B, C, D) together?</p>
          <textarea id="effect-e" name="effect-e" rows="3" data-persist
            placeholder="What happened because of this event?"
            class="auto w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-all duration-300"></textarea>
          <div class="mt-6 flex justify-end">
            <a href="#source-e-doc" class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold text-cyan-100 bg-cyan-500/20 border border-cyan-400/40 rounded-lg shadow-sm hover:bg-cyan-500/30 hover:text-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:ring-offset-2 focus:ring-offset-slate-900 transition">
              <span aria-hidden="true">⤴</span>
              <span>Back to Source E Reading</span>
            </a>
          </div>
        </div>
      </section>

      <!-- Sticky bottom action bar -->
      <div class="sticky bottom-0 full-bleed bg-slate-900/90 backdrop-blur border-t border-slate-700 py-4">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row items-center gap-3 md:gap-4">
          <button id="save-btn" type="button"
            class="w-full md:w-auto bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-6 rounded-full shadow transition">
            Save Progress
          </button>
          <button id="submit-btn" type="submit"
            class="w-full md:w-auto bg-gradient-to-r from-cyan-400 to-blue-500 hover:from-cyan-500 hover:to-blue-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition">
            Submit Timeline
          </button>
          <span id="save-status" class="ml-0 md:ml-2 text-sm text-slate-400">Not saved</span>
        </div>
      </div>
    </form>

    
  </div>

  <!-- Success Modal -->
  <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center border border-slate-700">
      <h3 class="text-2xl font-bold text-white mb-4">Submitted!</h3>
      <p class="text-slate-300 mb-6">Your timeline has been recorded.</p>
      <button id="close-modal" class="bg-cyan-500 hover:bg-cyan-600 text-white font-medium py-2 px-6 rounded-full transition">Close</button>
    </div>
  </div>

  <!-- Context Modal -->
  <div id="context-modal" class="fixed inset-0 bg-slate-950/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
    <div class="relative w-full max-w-2xl">
      <div class="absolute -inset-2 bg-gradient-to-r from-cyan-500/40 via-sky-500/30 to-violet-500/40 blur-3xl opacity-70"></div>
      <div class="relative overflow-hidden rounded-3xl border border-cyan-400/30 bg-slate-900/95 shadow-[0_25px_70px_rgba(14,165,233,0.35)]">
        <div class="absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-cyan-400 via-sky-400 to-violet-500"></div>
        <div class="p-6 md:p-10 space-y-8">
          <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
            <div>
              <p class="text-xs font-semibold uppercase tracking-[0.45em] text-cyan-300/80">What's going on at the time?</p>
              <h3 id="context-title" class="mt-2 text-3xl font-bold text-white leading-tight">Historical Context</h3>
              <p class="mt-3 text-sm text-slate-400 max-w-md">Use this panel to anchor each source in the larger story before you write your cause and effect.</p>
            </div>
            <button type="button" id="close-context-modal" class="self-start inline-flex items-center gap-2 rounded-full border border-slate-700/80 bg-slate-800/60 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-pink-400/70 hover:bg-pink-500/20 hover:text-white focus:outline-none focus:ring-2 focus:ring-pink-400/70 focus:ring-offset-2 focus:ring-offset-slate-900">
              <span aria-hidden="true">✕</span>
              <span>Close</span>
            </button>
          </div>
          <div id="context-body" class="space-y-6"><p class="text-slate-300">Loading context...</p></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Vocab Modal -->
  <div id="vocab-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
    <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl max-w-md w-full text-left border border-slate-700">
      <h3 id="vocab-title" class="text-2xl font-bold text-yellow-300 mb-4 capitalize">Vocabulary Word</h3>
      <div id="vocab-body" class="text-slate-300 mb-6 space-y-4"><p>Loading definition...</p></div>
      <button id="close-vocab-modal" class="bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-6 rounded-full transition">Close</button>
    </div>
  </div>

  <footer class="mt-16">
    <div class="container mx-auto px-4 pb-10 max-w-7xl"></div>
  </footer>

  <script>

    // (optional) light engagement tracker
    const engagement = { tabSwitches: 0, hiddenSeconds: 0, startedAt: Date.now(), lastHiddenAt: null };
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) { engagement.tabSwitches++; engagement.lastHiddenAt = Date.now(); }
      else if (engagement.lastHiddenAt) {
        engagement.hiddenSeconds += Math.round((Date.now() - engagement.lastHiddenAt) / 1000);
        engagement.lastHiddenAt = null;
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      const FORM_STORAGE_KEY = 'cause_effect_timeline_v1';
      const form = document.getElementById('timeline-form');
      const successModal = document.getElementById('success-modal');
      const closeModalBtn = document.getElementById('close-modal');
      const saveBtn = document.getElementById('save-btn');
      const saveStatus = document.getElementById('save-status');

      // Auto-resize for textareas
      const autoResize = (el) => { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; };
      document.querySelectorAll('textarea.auto').forEach(a => {
        autoResize(a);
        a.addEventListener('input', () => { autoResize(a); queueAutosave(); });
      });

      // Persist any element with data-persist (inputs, textareas, selects)
      const persistEls = Array.from(document.querySelectorAll('[data-persist]'));

      const setSavedStatus = (text) => { if (saveStatus) saveStatus.textContent = text; };
      const collectValues = () => {
        const data = {};
        persistEls.forEach(el => {
          if (!el.id) return;
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') data[el.id] = el.value || '';
          else if (el.tagName === 'SELECT') data[el.id] = el.value || '';
        });
        return data;
      };

      const saveProgress = () => {
        try {
          const data = collectValues();
          localStorage.setItem(FORM_STORAGE_KEY, JSON.stringify({ data, ts: Date.now() }));
          const t = new Date();
          const hh = t.getHours() % 12 || 12;
          const mm = String(t.getMinutes()).padStart(2, '0');
          const ampm = t.getHours() >= 12 ? 'PM' : 'AM';
          setSavedStatus(`Saved at ${hh}:${mm} ${ampm}`);
        } catch (e) {
          setSavedStatus('Save failed');
        }
      };

      const loadProgress = () => {
        const raw = localStorage.getItem(FORM_STORAGE_KEY);
        if (!raw) { setSavedStatus('No saved progress'); return; }
        try {
          const { data } = JSON.parse(raw);
          if (data) {
            persistEls.forEach(el => {
              if (!el.id) return;
              const val = data[el.id];
              if (typeof val !== 'undefined') {
                el.value = val;
                if (el.tagName === 'TEXTAREA') autoResize(el);
              }
            });
            setSavedStatus('Progress restored');
          }
        } catch {
          setSavedStatus('Could not load saved progress');
        }
      };

      // Debounced autosave
      let saveTimer = null;
      const queueAutosave = () => {
        if (saveTimer) clearTimeout(saveTimer);
        saveTimer = setTimeout(saveProgress, 700);
      };

      // Wire inputs for autosave
      persistEls.forEach(el => {
        el.addEventListener('input', queueAutosave);
        if (el.tagName === 'SELECT') el.addEventListener('change', queueAutosave);
      });

      // Manual save button
      saveBtn?.addEventListener('click', saveProgress);

      // Restore on load
      loadProgress();

      // Save before unload as safety
      window.addEventListener('beforeunload', saveProgress);

      const closeSuccessModal = () => successModal?.classList.add('hidden');
      closeModalBtn?.addEventListener('click', closeSuccessModal);
      successModal?.addEventListener('click', (e) => { if (e.target === successModal) closeSuccessModal(); });

      // Context + vocab modals (trimmed content for brevity)
      const contextModal = document.getElementById('context-modal');
      const contextTitle = document.getElementById('context-title');
      const contextBody = document.getElementById('context-body');
      const closeContextModalBtn = document.getElementById('close-context-modal');
      const contextButtons = document.querySelectorAll('.context-button');

      const sourceContext = {
        'A': {
          source: 'Source A: Pope Alexander VI, "Inter Caetera Bull" (1493)',
          scene: `This is the Pope back in 1493, right after Columbus sailed. He's telling Spain that any "new" land they find is theirs to keep, and they have a mission to convert the people living there. It's the "religious" justification that let European kings claim whole continents they'd never even seen.`,
          spotlight: 'The Papal bull hands Spain authority over lands it "discovers," creating the Doctrine of Discovery that European empires lean on for centuries.',
          connection: 'Keep this claim of Christian duty and superiority in mind when you look at how later U.S. leaders defend removing Native nations and seizing territory.'
        },
        'B': {
          source: "Source B: President Andrew Jackson's Message (1830)",
          scene: `Fast-forward to 1830, and President Andrew Jackson is pushing the Indian Removal Act. He tries to spin it as a "benevolent" (kind) deal, arguing that moving Native Americans west is for their own good. In reality, this was the policy that led to the Trail of Tears and cleared the South for white settlement.`,
          spotlight: 'Jackson sells removal as a favor to Native nations while opening millions of acres in the Southeast for white planters and expansion.',
          connection: 'Compare his rhetoric to the religious authority in Source A and notice how it paves the way for the Manifest Destiny thinking you will read in Source C.'
        },
        'C': {
          source: 'Source C: John O\'Sullivan, "Annexation" (1845)',
          scene: `This 1845 article is where the phrase "Manifest Destiny" was born. The writer is hyping up the U.S. taking Texas and says it's America's God-given destiny to expand all the way to the Pacific Ocean. He's already eyeing California, saying it's just "natural" that it will become part of the U.S.`,
          spotlight: 'O\'Sullivan coins "Manifest Destiny" to frame expansion as inevitable and blessed, preparing Americans to accept more territory stretching to the Pacific.',
          connection: 'As you write, connect this confident language to the government actions in Source B and the map evidence in Source D.'
        },
        'D': {
          source: 'Source D: United States Map (1842–1845)',
          scene: `This map shows the U.S. after it put those "Manifest Destiny" ideas into action. In just a few years, the U.S. added Texas, the Oregon Territory, and the massive area from Mexico after a war. This is what the country looked like after it expanded from "sea to shining sea."`,
          spotlight: 'The new borders reveal how quickly the United States converted ideology into land—annexing Texas, negotiating Oregon, and conquering Mexico.',
          connection: 'Use the visual proof here to show the effects of the ideas and policies described in Sources A, B, and C.'
        },
        'E': {
          source: 'Source E: Robert J. Miller, "Native America, Discovered and Conquered" (2008)',
          scene: `This is a modern historian explaining how all these sources are connected. He argues that the Pope's 1493 "Doctrine of Discovery" (Source A) became the legal and mental excuse for all of U.S. expansion. It's the "original idea" that allowed the U.S. to justify Indian Removal (Source B) and the land-grab of "Manifest Destiny" (Source C).`,
          spotlight: 'Miller shows that the Doctrine of Discovery never disappeared—it kept shaping U.S. law and policy long after the founding era.',
          connection: 'Bring his interpretation into your writing to stitch the cause-and-effect chain from Source A through the nineteenth-century expansion you tracked.'
        }
      };

      let activeContextButton = null;

      const openContextModal = (btn) => {
        const key = btn.getAttribute('data-source');
        const contextInfo = sourceContext[key];
        if (!contextInfo) return;
        contextTitle.innerText = 'Historical Context';
        contextBody.innerHTML = `
          <div class="rounded-2xl border border-cyan-400/40 bg-gradient-to-r from-cyan-500/20 via-sky-500/10 to-emerald-500/20 p-5 shadow-lg shadow-cyan-500/10">
            <p class="text-[0.7rem] font-semibold uppercase tracking-[0.55em] text-cyan-200/80">Source Spotlight</p>
            <p class="mt-3 text-lg font-semibold text-white">${contextInfo.source}</p>
          </div>
          <div class="grid gap-4 md:grid-cols-2">
            <div class="md:col-span-2 rounded-2xl border border-white/5 bg-slate-900/70 p-5 shadow-lg shadow-cyan-500/5">
              <p class="text-xs font-semibold uppercase tracking-[0.45em] text-pink-300/80 mb-3">Scene Setter</p>
              <p class="text-base leading-relaxed text-slate-100">${contextInfo.scene}</p>
            </div>
            <div class="rounded-2xl border border-slate-700/70 bg-slate-900/80 p-5 shadow-lg shadow-emerald-400/10">
              <p class="text-xs font-semibold uppercase tracking-[0.45em] text-emerald-300/80 mb-3">Key Move</p>
              <p class="text-base leading-relaxed text-slate-100">${contextInfo.spotlight}</p>
            </div>
            <div class="rounded-2xl border border-slate-700/70 bg-slate-900/80 p-5 shadow-lg shadow-amber-400/10">
              <p class="text-xs font-semibold uppercase tracking-[0.45em] text-amber-300/80 mb-3">Think About</p>
              <p class="text-base leading-relaxed text-slate-100">${contextInfo.connection}</p>
            </div>
          </div>
        `;
        btn.setAttribute('aria-expanded', 'true');
        activeContextButton = btn;
        contextModal.classList.remove('hidden');
      };

      contextButtons.forEach((btn) => {
        btn.addEventListener('click', () => openContextModal(btn));
      });

      const closeContextModal = () => {
        contextModal.classList.add('hidden');
        if (activeContextButton) {
          activeContextButton.setAttribute('aria-expanded', 'false');
          activeContextButton = null;
        }
      };
      closeContextModalBtn?.addEventListener('click', closeContextModal);

      const vocabModal = document.getElementById('vocab-modal');
      const vocabTitle = document.getElementById('vocab-title');
      const vocabBody = document.getElementById('vocab-body');
      const closeVocabBtn = document.getElementById('close-vocab-modal');

      const vocabDefinitions = {
        hitherto:'Until now', disposed:'Willing or inclined', 'apostolic favor':'Blessing by the Pope',
        dominions:'Territories controlled by a ruler', jurisdictions:'Legal authority', appurtenances:'Extra rights with property',
        benevolent:'Well meaning or kind', consummation:'Completion', induce:'Persuade', pecuniary:'Money related',
        tracts:'Large areas of land', annihilated:'Destroyed completely', perpetual:'Lasting forever',
        blazon:'Public display or symbol', geographical:'Related to location', adhesion:'Sticking to something',
        sovereignty:'Complete governing power', streaming:'Moving in large numbers'
      };

      document.querySelectorAll('.vocab-word').forEach(word => {
        const openVocab = () => {
          const key = word.getAttribute('data-vocab');
          const def = vocabDefinitions[key];
          if (!def) return;
          vocabTitle.innerText = key;
          vocabBody.innerHTML = `<p>${def}</p>`;
          vocabModal.classList.remove('hidden');
        };
        word.addEventListener('click', openVocab);
        word.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.keyCode === 13) openVocab(); });
      });

      const closeVocab = () => vocabModal.classList.add('hidden');
      closeVocabBtn?.addEventListener('click', closeVocab);
      contextModal?.addEventListener('click', (e) => {
        if (e.target === contextModal) closeContextModal();
      });

      vocabModal?.addEventListener('click', (e) => {
        if (e.target === vocabModal) vocabModal.classList.add('hidden');
      });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('timeline-form');
      const submitBtn = document.getElementById('submit-btn');
      const successModal = document.getElementById('success-modal');

      // your deployed Apps Script URL:
      const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbysN2uMbFHEp9OB1Jr8O7XM0sf4D-pJT7_rRmuCpfgw5jS7Rg82Gv30y8-nKCznRKyD/exec';

      const v = id => (document.getElementById(id)?.value || '').trim();

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // quick top-of-form validation you already do
        const fn = v('first-name'), ln = v('last-name'), cp = v('class-period');
        if (!fn || !ln || !cp) {
          document.getElementById('save-status').textContent = 'Please enter name and class period';
          return;
        }

        // build payload (keys match your sheet headers / FormEasy setFields)
        const payload = {
          'first_name': fn,
          'last_name': ln,
          'class_period': cp,
          'date-a': v('date-a'),  'cause-a': v('cause-a'),  'effect-a': v('effect-a'),
          'date-b': v('date-b'),  'cause-b': v('cause-b'),  'effect-b': v('effect-b'),
          'date-c': v('date-c'),  'cause-c': v('cause-c'),  'effect-c': v('effect-c'),
          'date-d': v('date-d'),  'cause-d': v('cause-d'),  'effect-d': v('effect-d'),
          'date-e': v('date-e'),  'cause-e': v('cause-e'),  'effect-e': v('effect-e'),
          // optional metadata:
          '_submitted_at': new Date().toISOString(),
          '_ua': navigator.userAgent
        };

        // disable button to prevent double submits
        submitBtn.disabled = true;
        submitBtn.classList.add('opacity-60','cursor-not-allowed');

        try {
          // Apps Script tip: use text/plain to avoid CORS preflight
          const res = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify(payload)
          });

          // many Apps Script endpoints return 200 OK with JSON
          let ok = res.ok;
          try {
            const j = await res.json();
            ok = ok && (j.ok !== false); // treat {ok:false} as failure if your script returns it
          } catch { /* ignore parse errors; some scripts return HTML */ }

          if (!ok) throw new Error('Submit failed');

          // show your existing success modal
          successModal?.classList.remove('hidden');

          // OPTIONAL: also download a CSV per-student (no server) — uncomment if you want
          /*
          const header = ['timestamp','last','first','period',
            'date-a','cause-a','effect-a','date-b','cause-b','effect-b',
            'date-c','cause-c','effect-c','date-d','cause-d','effect-d',
            'date-e','cause-e','effect-e'];
          const a = payload;
          const row = [
            a._submitted_at, a['last_name'], a['first_name'], a['class_period'],
            a['date-a'], a['cause-a'], a['effect-a'],
            a['date-b'], a['cause-b'], a['effect-b'],
            a['date-c'], a['cause-c'], a['effect-c'],
            a['date-d'], a['cause-d'], a['effect-d'],
            a['date-e'], a['cause-e'], a['effect-e'],
          ];
          const esc = s => /[",\n]/.test(String(s ?? '')) ? `"${String(s).replace(/"/g,'""')}"` : String(s ?? '');
          const csv = header.join(',') + '\n' + row.map(esc).join(',');
          const blob = new Blob(["\uFEFF" + csv], { type:'text/csv;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const ts = a._submitted_at.replace(/[:T]/g,'-').replace(/\..+/, '');
          const file = `submission_${a['last_name']}_${a['first_name']}_${ts}.csv`.replace(/\s+/g,'');
          const aTag = Object.assign(document.createElement('a'), { href:url, download:file });
          document.body.appendChild(aTag); aTag.click(); aTag.remove(); URL.revokeObjectURL(url);
          */
        } catch (err) {
          console.error(err);
          alert('Submission failed. Please try again.');
        } finally {
          submitBtn.disabled = false;
          submitBtn.classList.remove('opacity-60','cursor-not-allowed');
        }
      });
    });
  </script>
</body>
</html>
